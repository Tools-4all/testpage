<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Object Inspector with Consistent Indentation</title>
  <style>
    /* Unique CSS classes for Object Inspector */
    .objinsp-body {
      font-family: Menlo, Monaco, "Courier New", monospace;
      background-color: #1e1e1e;
      color: #d4d4d4;
      padding: 20px;
    }
    .objinsp-heading {
      color: #569cd6;
    }
    .objinsp-textarea {
      width: 100%;
      max-width: 600px;
      background: #252526;
      color: #d4d4d4;
      border: 1px solid #333;
      padding: 10px;
      font-size: 14px;
    }
    .objinsp-button {
      margin-top: 10px;
      padding: 8px 16px;
      background: #0e639c;
      color: #fff;
      border: none;
      cursor: pointer;
      font-size: 14px;
    }
    .objinsp-summary {
      cursor: pointer;
      user-select: none;
    }
    .objinsp-highlight-key {
      color: #9cdcfe;
    }
    .objinsp-highlight-string {
      color: #ce9178;
    }
    .objinsp-highlight-number {
      color: #b5cea8;
    }
    .objinsp-highlight-primitive {
      color: #ce9178;
    }
    .objinsp-highlight-type {
      color: #4ec9b0;
    }
    /* A helper class for generated nodes */
    .objinsp-node {
      /* Additional node styling can be added here if needed */
    }
    /* Reset default margin and padding for details and summary */
    details,
    summary {
      margin: 0;
      padding: 0;
    }
  </style>
</head>
<body class="objinsp-body">
  <h1 class="objinsp-heading">Object Inspector</h1>
  <p>Enter a JSON string or JavaScript expression (object, array, number, etc.):</p>
  <textarea id="objectInput" class="objinsp-textarea" rows="6" placeholder='e.g. { "name": "Alice", "age": 30, "nested": { "x": 10 } }'></textarea>
  <br>
  <button id="inspectBtn" class="objinsp-button">Inspect Object</button>
  <h2 class="objinsp-heading">Result:</h2>
  <div id="output"></div>
  <script>
    function createNode(key, value, visited, depth = 0) {
      const container = document.createElement('div');
      container.classList.add('objinsp-node');
      container.style.marginLeft = (depth * 10) + 'px';

      // Handle primitives
      if (value === null || (typeof value !== 'object' && typeof value !== 'function')) {
        if (key !== null && key !== undefined) {
          const keySpan = document.createElement('span');
          keySpan.className = 'objinsp-highlight-key';
          keySpan.textContent = key + ': ';
          container.appendChild(keySpan);
        }
        const valSpan = document.createElement('span');
        if (typeof value === 'string') {
          valSpan.className = 'objinsp-highlight-string';
          valSpan.textContent = '"' + value + '"';
        } else if (typeof value === 'number') {
          valSpan.className = 'objinsp-highlight-number';
          valSpan.textContent = String(value);
        } else {
          valSpan.className = 'objinsp-highlight-primitive';
          valSpan.textContent = String(value);
        }
        container.appendChild(valSpan);
        return container;
      }

      // Check for circular reference in the current recursion chain
      if (visited.has(value)) {
        if (key !== null && key !== undefined) {
          const keySpan = document.createElement('span');
          keySpan.className = 'objinsp-highlight-key';
          keySpan.textContent = key + ': ';
          container.appendChild(keySpan);
        }
        const circSpan = document.createElement('span');
        circSpan.textContent = '[Circular]';
        container.appendChild(circSpan);
        return container;
      }

      // Add the object to the current recursion stack
      visited.add(value);
      const details = document.createElement('details');
      const summary = document.createElement('summary');
      summary.classList.add('objinsp-summary');
      if (key !== null && key !== undefined) {
        const keySpan = document.createElement('span');
        keySpan.className = 'objinsp-highlight-key';
        keySpan.textContent = key + ': ';
        summary.appendChild(keySpan);
      }
      let headerText = '';
      if (typeof value === 'function') {
        headerText = 'Æ’ ' + (value.name || 'anonymous') + '()';
      } else if (Array.isArray(value)) {
        headerText = '[]';
      } else if (value.constructor === Object) {
        headerText = 'Object';
      } else {
        headerText = '{}';
      }
      const typeSpan = document.createElement('span');
      typeSpan.className = 'objinsp-highlight-type';
      typeSpan.textContent = headerText;
      summary.appendChild(typeSpan);
      details.appendChild(summary);

      // Process own string-keyed properties
      let props = [];
      try {
        props = Object.getOwnPropertyNames(value).sort();
      } catch (e) { }
      props.forEach(prop => {
        try {
          details.appendChild(createNode(prop, value[prop], visited, depth + 1));
        } catch (e) {
          const errorDiv = document.createElement('div');
          errorDiv.className = 'objinsp-highlight-key';
          errorDiv.innerHTML = `${prop}: <span style="color: white">(...)</span>`;
          errorDiv.style.marginLeft = ((depth) * 10) + 'px';
          details.appendChild(errorDiv);
        }
      });

      // Process symbol-keyed properties
      let symbols = [];
      try {
        symbols = Object.getOwnPropertySymbols(value).sort((a, b) =>
          a.toString().localeCompare(b.toString())
        );
      } catch (e) { }
      symbols.forEach(sym => {
        try {
          details.appendChild(createNode(sym.toString(), value[sym], visited, depth + 1));
        } catch (e) {
          const errorDiv = document.createElement('div');
          errorDiv.textContent = sym.toString() + ': [Error retrieving property]';
          details.appendChild(errorDiv);
        }
      });

      // Process the prototype chain
      try {
        const proto = Object.getPrototypeOf(value);
        if (proto) {
          details.appendChild(createNode('[[Prototype]]', proto, visited, depth + 1));
        }
      } catch (e) {
        const errorDiv = document.createElement('div');
        errorDiv.className = 'objinsp-highlight-key';
        errorDiv.innerHTML = `${prop}: <span style="color: white">(...)</span>`;
        errorDiv.style.marginLeft = ((depth) * 10) + 'px';
        details.appendChild(errorDiv);
      }

      container.appendChild(details);

      // Remove the object from the visited set once done processing it
      visited.delete(value);
      return container;
    }

    function renderInspector(obj) {
      const visited = new WeakSet();
      return createNode(null, obj, visited);
    }

    document.getElementById('inspectBtn').addEventListener('click', function () {
      const input = document.getElementById('objectInput').value;
      let obj;
      try {
        obj = JSON.parse(input);
      } catch (e) {
        try {
          obj = eval('(' + input + ')');
        } catch (ex) {
          alert('Invalid object input.');
          return;
        }
      }
      const output = document.getElementById('output');
      output.innerHTML = '';
      output.appendChild(renderInspector(obj));
    });
  </script>
</body>
</html>
