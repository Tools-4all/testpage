{% extends 'base_template.html' %}
{% block content %}
{% load static %}

<head>
  <title>Remove Background</title>
  <meta name="description" content="Remove background from images easily." />
  <link rel="stylesheet" href="{% static 'css/page_info.css' %}?v=1" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

  <style>
    img {
      -webkit-user-drag: none;
      user-drag: none;
    }

    #bigFooter {
      display: none;
    }

    #smallFooter {
      display: block;
    }

    @keyframes spin {
      from {
        transform: rotate(0deg);
      }

      to {
        transform: rotate(360deg);
      }
    }

    #spinner {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
    }

    .spinner img {
      width: 300px;
      height: 105px;
    }

    #mainDiv {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #removedImgBtn {
      display: none;
      margin-top: 0px;
      align-self: start;
      background-color: transparent;
      border: none;
      cursor: pointer;
      position: absolute;
      margin-top: 10px;
      margin-left: 10px;
      z-index: 50;
    }

    .uplodePhoto {
      padding-top: 5px;
      border-radius: 20px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .header {
      font-size: 22px;
      font-weight: 500;
      color: black;
    }

    .support {
      font-size: 18px;
      text-align: center;
      width: 80%;
      color: black;
      margin: 10px 0 15px 0;
    }

    #dropOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 2rem;
      z-index: 9999;
      display: none;
    }

    #dropOverlay h2 {
      font-family: Helvetica, Arial, sans-serif;
      font-size: 3.5rem;
      font-weight: 700;
      color: white;
    }

    #uploadBtn {
      color: white;
      border-radius: 30px;
      background: linear-gradient(135deg, #71b8fb 0%, #5da7f0 100%);
      border: none;
      padding: 12px 24px;
      font-size: 25px;
      font-weight: 600;
      transition: all 0.3s ease;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(113, 184, 251, 0.3);
      position: relative;
      overflow: hidden;
      animation: subtlePulse 3s ease-in-out infinite;
    }

    @keyframes subtlePulse {

      0%,
      100% {
        box-shadow: 0 4px 15px rgba(113, 184, 251, 0.3);
      }

      50% {
        box-shadow: 0 4px 20px rgba(113, 184, 251, 0.5);
      }
    }

    #uploadBtn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s ease;
    }

    #uploadBtn:hover {
      background: linear-gradient(135deg, #5da7f0 0%, #4a96e6 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(113, 184, 251, 0.4);
      animation: none;
    }

    #uploadBtn:hover::before {
      left: 100%;
    }

    #uploadBtn img {
      width: 40px;
      margin-left: 10px;
    }

    #uploadBtn:active {
      transform: translateY(0);
      box-shadow: 0 2px 10px rgba(113, 184, 251, 0.3);
    }

    .dragBox {
      background-image: url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='31' ry='31' stroke='%23050575FF' stroke-width='11' stroke-dasharray='2%2c 6' stroke-dashoffset='100' stroke-linecap='butt'/%3e%3c/svg%3e");
      border-radius: 31px;
      background-color: white;
      height: 280px;
      width: 540px;
      font-family: 'Roboto', sans-serif;
      font-size: 35px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      margin: 10px auto;
      overflow: hidden;
      transition: all 0.3s ease;
      position: relative;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    }

    .dragBox::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(113, 184, 251, 0.05) 0%, rgba(93, 167, 240, 0.1) 100%);
      opacity: 0;
      transition: opacity 0.3s ease;
      border-radius: 31px;
      z-index: 1;
    }

    .dragBox:hover::before {
      opacity: 1;
    }

    .dragBox:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
    }

    .dragBox * {
      position: relative;
      z-index: 2;
    }

    .dragBox input[type="file"] {
      display: none;
    }

    .draging {
      transform: scale(1.02) translateY(-5px);
      box-shadow: 0 10px 40px rgba(113, 184, 251, 0.3);
    }

    .draging::before {
      opacity: 1;
    }

    #previewDiv {
      display: flex;
    }

    #previewImage {
      min-width: 400px;
      min-height: 437px;
      max-width: 550px;
      max-height: 375px;
    }

    #previewImage img {
      background-color: transparent;
      width: 100%;
      height: 100%;
      max-height: 437px;
      border: 1px solid black;
      border-radius: 25px;
      overflow: hidden;
      object-fit: contain;
    }

    #overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 9998;
    }

    .stars-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      overflow: hidden;
      z-index: 20;
      display: none;
      border-radius: 25px;
    }

    @keyframes spinAndFade {
      0% {
        opacity: 0;
        transform: rotate(0deg) scale(0);
      }

      10% {
        opacity: 0.3;
      }

      50% {
        opacity: 1;
        transform: rotate(360deg) scale(1.8);
      }

      80% {
        opacity: 0.8;
      }

      100% {
        opacity: 0;
        transform: rotate(720deg) scale(0);
      }
    }

    .star {
      position: absolute;
      width: 20px;
      height: 20px;
      background: linear-gradient(45deg, #71b8fb, #5da7f0, #4a96e6);
      clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
      animation: spinAndFade 2s ease-in-out infinite;
      animation-play-state: paused;
      filter: drop-shadow(0 0 6px rgba(113, 184, 251, 0.6));
    }

    .imageHolder {
      position: relative;
      display: inline-block;
      width: 100%;
      height: 100%;
      background-color: transparent;
    }

    .imageHolder img {
      border-radius: 25px;
    }

    .backgroundLayer {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
      border-radius: 25px;
    }

    .checkerboard {
      background-color: #fff;
      background-image:
        linear-gradient(45deg, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),
        linear-gradient(45deg, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);
      background-size: 20px 20px;
      background-position: 0 0, 10px 10px;
    }

    .transparentBtn {
      background-image:
        linear-gradient(45deg, #ddd 25%, #fff 25%, #fff 50%, #ddd 50%, #ddd 75%, #fff 75%, #fff),
        linear-gradient(-45deg, #ddd 25%, #fff 25%, #fff 50%, #ddd 50%, #ddd 75%, #fff 75%, #fff);
      background-size: 10px 10px;
      /* Match checkerboard size */
    }

    .img-original {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 3;
      border-radius: 25px;
    }

    .removedImg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 2;
      opacity: 1;
      border-radius: 25px;
    }

    .img-original.slide-away {
      clip-path: polygon(0% 0%, 0% 0%, 0% 100%, 0% 100%);
      transition: clip-path 1.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .img-original.slide-complete {
      display: none;
    }

    @keyframes slideReveal {
      0% {
        clip-path: polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%);
      }

      100% {
        clip-path: polygon(0% 0%, 0% 0%, 0% 100%, 0% 100%);
      }
    }

    .image-overlay {
      display: none;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.71);
      pointer-events: none;
      z-index: 15;
      padding: 5px;
      border-radius: 25px;
    }

    .overlay-slide-out {
      animation: slideReveal 1s ease forwards;
    }

    .BgColorChange {
      border: 2px dashed #ccc !important;
      background-color: #f3f3f3;
    }

    #hiddenDiv {
      position: relative;
      display: none;
      flex-direction: column;
      margin-left: 30px;
      text-align: center;
      position: relative;
    }

    #circleBtnDiv {
      display: flex;
    }

    .circleBtn {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: 2px solid #e0e6ed;
      cursor: pointer;
      position: relative;
      margin-top: 20px;
      margin-right: 15px;
      transition: all 0.3s ease;
      background: white;
      box-shadow: 0 3px 15px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .circleBtn::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(113, 184, 251, 0.1) 0%, rgba(93, 167, 240, 0.2) 100%);
      opacity: 0;
      transition: opacity 0.3s ease;
      border-radius: 50%;
    }

    .circleBtn:hover {
      transform: translateY(-3px);
      border-color: #71b8fb;
      box-shadow: 0 6px 25px rgba(113, 184, 251, 0.2);
    }

    .circleBtn:hover::before {
      opacity: 1;
    }

    .circleBtn img,
    .circleBtn svg {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      position: relative;
      z-index: 2;
      transition: transform 0.3s ease;
    }

    .circleBtn:hover img,
    .circleBtn:hover svg {
      transform: scale(1.1);
    }

    .circleBtnP {
      margin-top: 35px;
      font-weight: 700;
    }

    #bgImage {
      width: 71%;
      margin-top: 10px;
      border-radius: 0px;
    }

    #downloadBtn {
      position: absolute !important;
      bottom: 0px;
      left: 0px;
      background: linear-gradient(135deg, #71b8fb 0%, #5da7f0 100%);
      border: none;
      color: white;
      padding: 14px 28px;
      border-radius: 35px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(113, 184, 251, 0.3);
      position: relative;
      overflow: hidden;
    }

    #downloadBtn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s ease;
    }

    #downloadBtn:hover::before {
      left: 100%;
    }

    #downloadBtn:hover {
      background: linear-gradient(135deg, #5da7f0 0%, #4a96e6 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(113, 184, 251, 0.4);
    }

    #downloadBtn:active {
      transform: translateY(0);
      box-shadow: 0 2px 10px rgba(113, 184, 251, 0.3);
    }

    #closeColorsDiv {
      position: absolute;
      top: 8px;
      width: 7px;
      height: 7px;
    }

    #closeColorsDiv:focus,
    #closeColorsDiv:active {
      outline: none !important;
      box-shadow: none;
    }

    #colorsDiv {
      position: relative;
      display: none;
      margin-left: 30px;
      width: 275px;
      border: 1px solid #e0e6ed;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
      border-radius: 25px;
      padding: 20px;
      background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
      backdrop-filter: blur(10px);
    }

    #colorsDiv h2 {
      font-size: 18px;
      margin-bottom: 15px;
      margin-top: 10px;
      color: #2c3e50;
      font-weight: 600;
    }

    .colorBtn {
      width: 50px;
      height: 50px;
      border-radius: 12px;
      border: 2px solid #e0e6ed;
      margin: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .colorBtn::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.2);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .colorBtn:hover {
      transform: translateY(-2px);
      border-color: #71b8fb;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .colorBtn:hover::before {
      opacity: 1;
    }

    #customColorDiv {
      position: relative;
      display: flex;
      justify-content: center;
      margin-top: 35px;
    }

    #colorPreview {
      width: 120px;
      height: 50px;
      border-radius: 10px;
      border: 2px solid #aaa7a7;
      background-color: #f8e9e9;
      padding: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: bold;
    }

    #customColor {
      opacity: 0;
      position: absolute;
      width: 100px;
      height: 50px;
      cursor: pointer;
    }

    .lambo-title {
      font-size: 30px;
      font-weight: 700;
      color: #333;
      margin-bottom: 15px;
      margin-top: 80px;
      text-align: center;
    }

    @media (max-width: 840px) {
      .functionTitle {
        font-size: 35px;
        margin-right: 10px;
      }

      .lambo-title {
        font-size: 25px;
      }

      .info-title {
        font-size: 25px;
      }

      .blog-content h2 {
        font-size: 25px;
      }

      .btn-info {
        margin-left: 2px;
        margin-top: 12px;
      }

      .dragBox {
        width: 320px;
      }

      .wrapper {
        height: 101vh;
        width: 100%;
      }

      .uplodePhoto {
        width: 95%;
        padding: 0px;
      }

      #previewDiv {
        flex-direction: column;
      }

      #previewImage {
        min-width: 400px;
        min-height: 330px;
      }

      #hiddenDiv {
        flex-direction: row;
        margin-left: 0px;
        justify-content: space-between;
      }

      #circleBtnDiv {
        flex-direction: column;
        align-items: center;
        width: 40%;
      }

      .circleBtnP {
        margin-top: 0px;
        margin-bottom: 70px;
        font-size: 14px;
      }

      #removedImgBtn {
        margin-left: 10px;
        margin-top: 9px;
      }

      #downloadBtn {
        margin-top: 50px;
      }

      #error {
        width: 70%;
      }

      #error p {
        font-size: 12px;
      }

      #uploadBtn {
        font-size: 20px;
      }

      #colorsDiv {
        width: 100%;
        margin: 15px auto;
      }
    }

    .lambo-comparison-container {
      position: relative;
      width: 900px;
      height: 500px;
      overflow: hidden;
      border-radius: 25px;
      border: 3px solid #5da7f0;
      user-select: none;
    }

    .lambo-comparison-container img {
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
      pointer-events: none;
    }

    .lambo-background {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 0;
    }

    .lambo-background-wrapper {
      position: absolute;
      top: 0;
      left: 0;
      width: 50%;
      /* חצי בהתחלה */
      height: 100%;
      overflow: hidden;
      z-index: 1;
    }

    .lambo-grid {
      z-index: 1;
      background-repeat: repeat;
      background-size: 40px 40px;
      /* גודל ריבוע קבוע */
    }

    .lambo-foreground {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;
      /* שומר פרופורציות ומרכז את הרכב */
      z-index: 2;
      pointer-events: none;
    }

    .lambo-comparison-handle {
      position: absolute;
      top: 0;
      left: 50%;
      width: 0;
      height: 100%;
      z-index: 3;
      cursor: ew-resize;
    }

    .lambo-handle-circle {
      position: absolute;
      top: 50%;
      left: 0;
      transform: translate(-50%, -50%);
      width: 50px;
      height: 50px;
      background: #ffffff99;
      border: 2px solid #000;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: width 0.3s, height 0.3s, box-shadow 0.3s, background 0.3s;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
    }

    .lambo-handle-circle:hover,
    .lambo-handle-circle.active {
      background: #ffffffdc;
      width: 55px;
      height: 55px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    }

    .lambo-arrow {
      display: inline-block;
      width: 0;
      height: 0;
      border-top: 6px solid transparent;
      border-bottom: 6px solid transparent;
      transition: border-width 0.3s;
    }

    .lambo-arrow.left {
      border-right: 8px solid black;
      margin-right: 4px;
    }

    .lambo-arrow.right {
      border-left: 8px solid black;
      margin-left: 4px;
    }

    .lambo-handle-circle:hover .lambo-arrow,
    .lambo-handle-circle.active .lambo-arrow {
      border-top-width: 8px;
      border-bottom-width: 8px;
    }

    .lambo-handle-circle:hover .lambo-arrow.left,
    .lambo-handle-circle.active .lambo-arrow.left {
      border-right-width: 10px;
    }

    .lambo-handle-circle:hover .lambo-arrow.right,
    .lambo-handle-circle.active .lambo-arrow.right {
      border-left-width: 10px;
    }

    @media (max-width: 768px) {
      .lambo-comparison-container {
        max-width: 90%;
        height: 280px;
        aspect-ratio: 4 / 2;
      }
    }
  </style>
</head>

<body>
  <div id="spinner">
    <div class="spinner" style="display: flex;">
      <img src="{% static 'site_images/spinner.svg' %}" alt="spinner" draggable="false">
    </div>
    <p>Loading model, please wait...</p>
  </div>

  <div id="mainDiv" style="display: none;">
    <div class="titleDiv">
      <h1 class="functionTitle" id="title">Remove background from image</h1>
    </div>

    <div class="uplodePhoto">
      <div class="dragBox" id="dragBox">
        <button id="uploadBtn" onclick="document.getElementById('uploadFile').click()">
          Upload your image
          <img src="{% static 'site_images/upload.webp' %}" alt="Upload your image">
        </button>
        <span class="header" id="browseBtn">or drop it here</span>
        <span class="support"><span style="font-weight: bold;">Supports:</span> jpeg, png, gif, webp, bmp, ico, svg, ff,
          hdr, qoi, tga, pnm</span>
        <input type="file" accept=".jpeg, .jpg, .png, .gif, .svg, .webp, .bmp, .ico, .svg, .ff, .hdr, .qoi, .tga, .pnm"
          onChange="handleFileSelect(event)" id="uploadFile" />
      </div>

      <div id="previewDiv">
        <div id="previewImage" style="display: none;">
          <button type="button" onclick="removeImage()" id="removedImgBtn">
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="25"
              height="25" viewBox="0 0 256 256" xml:space="preserve">
              <g style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;"
                transform="translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)">
                <circle cx="45" cy="45" r="45"
                  style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(230,62,50); fill-rule: nonzero; opacity: 1;" />
                <path
                  d="M 27.169 64.83 c -0.512 0 -1.024 -0.195 -1.414 -0.586 c -0.781 -0.781 -0.781 -2.047 0 -2.828 l 35.661 -35.661 c 0.781 -0.781 2.047 -0.781 2.828 0 c 0.781 0.781 0.781 2.047 0 2.828 L 28.583 64.244 C 28.193 64.635 27.681 64.83 27.169 64.83 z"
                  style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(255,255,255); fill-rule: nonzero; opacity: 1;" />
                <path
                  d="M 62.83 64.83 c -0.512 0 -1.023 -0.195 -1.414 -0.586 L 25.755 28.583 c -0.781 -0.781 -0.781 -2.047 0 -2.828 c 0.78 -0.781 2.048 -0.781 2.828 0 l 35.661 35.661 c 0.781 0.781 0.781 2.047 0 2.828 C 63.854 64.635 63.342 64.83 62.83 64.83 z"
                  style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(255,255,255); fill-rule: nonzero; opacity: 1;" />
              </g>
            </svg>
          </button>
          <div class="imageHolder">
            <div class="backgroundLayer"></div>
            <img class="img-original" src="" />
            <img class="removedImg" src="" />
            <div class="image-overlay"></div>
            <div class="stars-container"></div>
          </div>
        </div>

        <div id="hiddenDiv">
          <div id="circleBtnDiv">
            <div class="circleBtn" onclick="displayColors()">
              <img src="{% static 'site_images/rgb.webp' %}" alt="change background color" loading="lazy">
            </div>
            <p class="circleBtnP">Change Background Color</p>
          </div>

          <div id="circleBtnDiv" style="align-items: center;">
            <div class="circleBtn" id="uploadSection" style="padding-top: 2px;">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="48" height="48">
                <rect x="14" y="14" width="20" height="20" rx="3" ry="3" fill="none" stroke="#000000"
                  stroke-width="2" />
                <path d="M24 18 L20 22 H22 V26 H26 V22 H28 Z" fill="#000000" />
                <rect x="18" y="28" width="12" height="2" fill="#000000" />
              </svg>
            </div>
            <p class="circleBtnP">Add background image</p>
            <input type="file" id="imageUploader" accept="image/*" style="display: none;">
          </div>

          <button id="downloadBtn">download</button>
        </div>

        <div id="colorsDiv">
          <button type="button" id="closeColorsDiv" class="btn-close" aria-label="Close"></button>
          <h2>Change background color</h2>
          <div style="display: flex; flex-wrap: wrap; justify-content: center;">
            <button class="colorBtn" style="background-color: white;"></button>
            <button class="colorBtn" style="background-color: black;"></button>
            <button class="colorBtn" style="background-color: gray;"></button>
            <button class="colorBtn" style="background-color: red;"></button>
            <button class="colorBtn" style="background-color: orange;"></button>
            <button class="colorBtn" style="background-color: yellow;"></button>
            <button class="colorBtn" style="background-color: purple;"></button>
            <button class="colorBtn" style="background-color: blue;"></button>
            <button class="colorBtn" style="background-color: green;"></button>
            <button class="colorBtn transparentBtn" style="width: 100px;">Transparent</button>
          </div>

          <div id="customColorDiv">
            <input type="color" id="customColor">
            <div id="colorPreview">
              Pick a color
            </div>
          </div>
        </div>
      </div>
    </div>


    <div data-aos="fade" data-aos-duration="700">
      <h2 class="lambo-title">Experience the Precision & Quality of Tools 4 All</h2>
      <div class="lambo-comparison-container">
        <div class="lambo-background-wrapper">
          <img src="https://raw.githubusercontent.com/Tools-4all/images/main/lambo_grid.png" class="lambo-grid"
            alt="Transparent Grid">
        </div>

        <img src="https://raw.githubusercontent.com/Tools-4all/images/main/lambo_background.png"
          class="lambo-background" alt="Background">

        <img src="https://raw.githubusercontent.com/Tools-4all/images/main/lambo_transparent.png"
          class="lambo-foreground" alt="Lamborghini Transparent">

        <div class="lambo-comparison-handle">
          <div class="lambo-handle-circle">
            <span class="lambo-arrow left"></span>
            <span class="lambo-arrow right"></span>
          </div>
        </div>
      </div>
    </div>

    <div class="web-guide" data-aos="fade" data-aos-duration="700">
      <h2>How to Remove Background from an Image</h2>
      <div class="guide-steps">
        <div class="step">
          <h3>Upload your image</h3>
          <p>Upload or drag & drop the image you want to edit</p>
        </div>
        <div class="guide_arrow">➔</div>
        <div class="step">
          <h3>Remove background automatically</h3>
          <p>Our AI instantly removes the background with precision</p>
        </div>
        <div class="guide_arrow">➔</div>
        <div class="step">
          <h3>Download your image</h3>
          <p>Save the background-free image in PNG or JPG</p>
        </div>
      </div>
    </div>

    <div class="carousel-container" data-aos="fade" data-aos-duration="700">
      <h2 style="font-size: 25px; text-align: center; font-weight: 700; color: #333;width: 90%;">
        How to Remove Background from an Image
      </h2>
      <div class="carousel">
        <div class="carousel_step">
          <h3>Upload your image</h3>
          <p>Upload or drag & drop the image you want to edit</p>
        </div>
        <div class="carousel_step">
          <h3>Remove background automatically</h3>
          <p>Our AI instantly removes the background with precision</p>
        </div>
        <div class="carousel_step">
          <h3>Download your image</h3>
          <p>Save the background-free image in PNG or JPG</p>
        </div>
      </div>
    </div>

    <div id="page-info" class="info-section" data-aos="fade" data-aos-duration="700">
      <h2 class="info-title">Remove Background from Any Image in Seconds</h2>
      <p class="info-text">
        Our background remover tool instantly erases backgrounds from your images while keeping the main subject sharp
        and clear. Perfect for e-commerce, presentations, profile pictures, and creative projects.
      </p>
      <h3 class="info-subtitle">Why Use Our Background Remover?</h3>
      <ul class="info-list">
        <li class="info-list-item">Fast and accurate AI-powered background removal.</li>
        <li class="info-list-item">Supports JPEG, PNG, and many other image formats.</li>
        <li class="info-list-item">Preserves image quality without compression loss.</li>
        <li class="info-list-item">No sign-up or installation required – 100% online and private.</li>
      </ul>
      <p class="info-text">
        Upload your image now and get a clean, professional result instantly.
      </p>
    </div>



    <div id="page-blog" class="blog-content" data-aos="fade" data-aos-duration="700">
      <h2>Remove Background from Images – Free Online Tool</h2>
      <p>
        Our <strong>Remove Background</strong> tool is the easiest way to erase backgrounds from your photos while
        keeping the subject clear and detailed.
        Whether you need product images, profile pictures, or creative edits, this tool gives you perfect results in
        seconds.
      </p>

      <h3>Why Remove Background from Images?</h3>
      <p>
        Removing backgrounds helps create clean, professional-looking images that are perfect for online stores,
        presentations, social media, and graphic design.
      </p>

      <h4>Benefits of Using Our Tool</h4>
      <ul>
        <li><strong>Clean Look:</strong> Highlight your subject without distractions.</li>
        <li><strong>Instant Results:</strong> AI processing in just a few seconds.</li>
        <li><strong>High Quality:</strong> Maintains resolution and sharpness.</li>
        <li><strong>Free & Online:</strong> No installation required, works in your browser.</li>
      </ul>

      <h3>How It Works</h3>
      <ol>
        <li>Upload your image by clicking the upload button or dragging it to the drop area.</li>
        <li>Our AI instantly removes the background.</li>
        <li>Preview and download your background-free image in PNG or JPG format.</li>
      </ol>

      <h4>Start Now</h4>
      <p>
        Use our <strong>free online background remover</strong> and get clean, professional images instantly.
      </p>
    </div>



    <section class="faq-section" data-aos="fade" data-aos-duration="700">
      <h2 class="faq-title">Frequently Asked Questions (FAQ)</h2>

      <div class="faq">
        <h3 class="faq-question" onclick="toggleAnswer(this)">How does the background remover tool work?</h3>
        <div class="faq-answer">
          <p>Our tool uses advanced AI technology to detect and isolate the subject in your image, removing the
            background automatically within seconds.</p>
        </div>
      </div>

      <div class="faq">
        <h3 class="faq-question" onclick="toggleAnswer(this)">Can I change the background after removing it?</h3>
        <div class="faq-answer">
          <p>Yes. You can keep the background transparent, change it to a solid color, or replace it with another
            image
            using our built‑in editor.</p>
        </div>
      </div>

      <div class="faq">
        <h3 class="faq-question" onclick="toggleAnswer(this)">Will the image quality be preserved?</h3>
        <div class="faq-answer">
          <p>Yes. The tool processes your image without compression, keeping the original quality and resolution
            intact.
          </p>
        </div>
      </div>

      <div class="faq">
        <h3 class="faq-question" onclick="toggleAnswer(this)">Which image formats are supported?</h3>
        <div class="faq-answer">
          <p>Supported formats include JPEG, PNG, WebP, BMP, ICO, GIF, and more.</p>
        </div>
      </div>
    </section>

  </div>



  <script src="{% static 'js/errorComponent.js' %}"></script>
  <script>
    const removedImgBtn = document.getElementById("removedImgBtn");
    const hiddenDiv = document.getElementById("hiddenDiv");
    const dragBox = document.getElementById("dragBox");
    const uploadFileInput = document.getElementById("uploadFile");
    const downloadBtn = document.getElementById("downloadBtn");
    const previewImg = document.getElementById("previewImage");
    const colorsDiv = document.getElementById("colorsDiv");
    const customColorInput = document.getElementById("customColor");
    const colorPreview = document.getElementById("colorPreview");

    let backgroundType = 'transparent';
    let backgroundValue = null;
    let originalForegroundDataUrl = null;

    const modelPath = "https://huggingface.co/tools-4all/bg_remover/resolve/main/bg_remover.onnx";
    const cacheName = "bg-remover-model-cache";
    const modelCacheKey = "bg-remover-model";

    // Initialize Web Worker
    function initWorker() {
      worker = new Worker("{% static 'js/bgRemovalWorker.js' %}");
      worker.onmessage = (e) => {
        console.log("Main: Received message from worker:", e.data);
        const { type, data, error } = e.data;
        if (type === "result") {
          console.log("Main: Processing result with dataURL:", data);
          handleWorkerResult(data);
        } else if (type === "error") {
          console.log("Main: Worker error:", error);
          handleWorkerError(error);
        } else if (type === "modelLoaded") {
          console.log("Main: Model loaded in worker");
          stopSpinner();
        }
      };
      worker.onerror = (error) => {
        console.error("Main: Worker error event:", {
          message: error.message,
          filename: error.filename,
          lineno: error.lineno,
          colno: error.colno,
          error: error
        });
        handleWorkerError("Worker failed: " + (error.message || "Unknown error"));
      };
    }

    async function preloadModel() {
      try {
        const cache = await caches.open(cacheName);
        const cachedResponse = await cache.match(modelCacheKey);
        if (cachedResponse) {
          console.log("Model found in cache");
          const blob = await cachedResponse.blob();
          worker.postMessage({ type: "loadModel", modelUrl: URL.createObjectURL(blob) });
          return;
        }

        console.log("Fetching model...");
        const response = await fetch(modelPath);
        if (!response.ok) throw new Error("Failed to fetch model");

        const responseToCache = response.clone();
        await cache.put(modelCacheKey, responseToCache);

        const blob = await response.blob();
        worker.postMessage({ type: "loadModel", modelUrl: URL.createObjectURL(blob) });
      } catch (err) {
        console.error("Model preload failed:", err);
        showError("Failed to preload the model");
      }
    }

    // Stop spinner and show main content
    function stopSpinner() {
      const spinnerDiv = document.getElementById("spinner");
      const spinner = document.querySelector(".spinner img");

      spinner.classList.remove("spin-active");
      spinnerDiv.style.display = "none";
      document.getElementById("mainDiv").style.display = "flex";
    }

    // Initialize on page load
    window.addEventListener("load", async () => {
      console.log("Main: Initializing worker and preloading model");
      initWorker();
      await preloadModel();
    });

    // Drag and drop overlay
    const overlay = document.createElement("div");
    overlay.id = "dropOverlay";
    const overlayText = document.createElement("h2");
    overlayText.textContent = "Drop anywhere you want";
    overlay.appendChild(overlayText);
    document.body.appendChild(overlay);

    document.addEventListener("dragover", (event) => {
      event.preventDefault();
      overlay.style.display = "flex";
      dragBox.classList.add("draging");
    });

    document.addEventListener("dragleave", (event) => {
      if (event.relatedTarget === null || event.relatedTarget.nodeName === "HTML") {
        overlay.style.display = "none";
        dragBox.classList.remove("draging");
      }
    });

    document.addEventListener("drop", async (event) => {
      event.preventDefault();
      overlay.style.display = "none";
      dragBox.classList.remove("draging");

      const files = event.dataTransfer.files;
      if (files.length) {
        const file = files[0];
        console.log("Main: Dropped file:", file.name);
        await handleFileSelect(file, true);
      }
    });


    // Read file as Data URL
    function readFileAsDataURL(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = (err) => reject(err);
        reader.readAsDataURL(file);
      });
    }

    // Composite background with foreground image
    async function compositeImages(foregroundSrc, backgroundSrc = null, backgroundColor = null) {
      console.log("Main: Compositing images");
      try {
        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d");

        const foregroundImg = new Image();
        foregroundImg.src = foregroundSrc;
        await new Promise((resolve, reject) => {
          foregroundImg.onload = resolve;
          foregroundImg.onerror = reject;
        });

        canvas.width = foregroundImg.width;
        canvas.height = foregroundImg.height;

        if (backgroundColor) {
          console.log("Main: Applying background color:", backgroundColor);
          ctx.fillStyle = backgroundColor;
          ctx.fillRect(0, 0, canvas.width, canvas.height);
        } else if (backgroundSrc) {
          console.log("Main: Applying background image");
          const backgroundImg = new Image();
          backgroundImg.src = backgroundSrc;
          await new Promise((resolve, reject) => {
            backgroundImg.onload = resolve;
            backgroundImg.onerror = reject;
          });

          const fgAspect = canvas.width / canvas.height;
          const bgAspect = backgroundImg.width / backgroundImg.height;

          let srcWidth, srcHeight, srcX, srcY;

          if (bgAspect > fgAspect) {
            srcHeight = backgroundImg.height;
            srcWidth = srcHeight * fgAspect;
            srcX = (backgroundImg.width - srcWidth) / 2;
            srcY = 0;
          } else {
            srcWidth = backgroundImg.width;
            srcHeight = srcWidth / fgAspect;
            srcX = 0;
            srcY = (backgroundImg.height - srcHeight) / 2;
          }

          ctx.drawImage(
            backgroundImg,
            srcX, srcY, srcWidth, srcHeight,
            0, 0, canvas.width, canvas.height
          );
        }

        ctx.drawImage(foregroundImg, 0, 0);

        const dataURL = canvas.toDataURL("image/png");
        console.log("Main: Compositing complete, dataURL length:", dataURL.length);
        return dataURL;
      } catch (err) {
        console.error("Main: Error in compositeImages:", err);
        throw err;
      }
    }

    function displayImages(originalSrc) {
      const oldHolder = previewImg.querySelector(".imageHolder");
      if (oldHolder) oldHolder.remove();

      const imageHolder = document.createElement("div");
      imageHolder.classList.add("imageHolder");

      const backgroundLayer = document.createElement("div");
      backgroundLayer.classList.add("backgroundLayer");
      imageHolder.appendChild(backgroundLayer);

      const removedImgEl = document.createElement("img");
      removedImgEl.classList.add("removedImg");

      const transparentPlaceholder =
        "data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";
      removedImgEl.src = transparentPlaceholder;

      imageHolder.appendChild(removedImgEl);


      const originalImgEl = document.createElement("img");
      originalImgEl.src = originalSrc;
      originalImgEl.classList.add("img-original");
      imageHolder.appendChild(originalImgEl);

      const overlay = document.createElement("div");
      overlay.id = "imageOverlay";
      overlay.classList.add("image-overlay");
      imageHolder.appendChild(overlay);

      const starsContainer = document.createElement("div");
      starsContainer.classList.add("stars-container");
      createStars(starsContainer);
      imageHolder.appendChild(starsContainer);

      previewImg.appendChild(imageHolder);

      dragBox.style.display = "none";
      previewImg.style.display = "block";
      document.getElementById('title').style.display = "none";

      if (removedImgBtn) {
        removedImgBtn.style.display = "none";
      }

      return removedImgEl;
    }


    async function handleFileSelect(e, isFile = false) {
      const file = isFile ? e : (e.target.files || e.dataTransfer.files)[0];
      if (!file) {
        console.log("Main: No file selected");
        return;
      }

      const allowedTypes = ["image/jpeg", "image/png", "image/webp", "image/gif", "image/bmp", "image/svg+xml", "image/vnd.microsoft.icon"];
      if (!allowedTypes.includes(file.type)) {
        showError("Unsupported file type. Please upload a valid image.");
        console.log("Main: Unsupported file type:", file.type);
        return;
      }

      try {
        console.log("Main: Handling file:", file.name);
        const originalDataURL = await readFileAsDataURL(file);
        const removedImgEl = displayImages(originalDataURL);

        startStarsAnimation(true);

        const arrayBuffer = await file.arrayBuffer();
        console.log("Main: Sending file to worker, arrayBuffer size:", arrayBuffer.byteLength);
        worker.postMessage(
          { type: "removeBg", arrayBuffer: arrayBuffer, fileName: file.name, fileType: file.type },
          [arrayBuffer]
        );

        removedImgEl.onerror = () => {
          console.error("Main: Failed to load background-removed image");
          showError("Failed to load the background-removed image.");
          removeImage();
        };
      } catch (err) {
        console.error("Main: Error in handleFileSelect:", err);
        showError("Failed to remove background");
        removeImage();
      }
    }

    // Handle Web Worker result
    async function handleWorkerResult(dataURL) {
      console.log("Main: Handling worker result, dataURL length:", dataURL ? dataURL.length : "null");

      const removedImgEl = previewImg.querySelector(".removedImg");
      if (!removedImgEl) {
        console.error("Main: removedImgEl not found");
        showError("Failed to find image element");
        removeImage();
        return;
      }

      if (!dataURL || typeof dataURL !== "string" || !dataURL.startsWith("data:image/png")) {
        console.error("Main: Invalid dataURL received:", dataURL);
        showError("Invalid background-removed image data");
        removeImage();
        return;
      }

      originalForegroundDataUrl = dataURL;

      // Show processed image immediately behind overlay
      removedImgEl.src = dataURL;

      removedImgEl.onload = () => {
        console.log("Main: Background-removed image loaded successfully");

        removedImgBtn.style.display = "block";
        hiddenDiv.style.display = "flex";

        // Start stars+overlay slide-out animation at the same time image is ready
        startStarsAnimation(false);

        // Also hide the original image at the same time
        const originalImgEl = previewImg.querySelector(".img-original");
        if (originalImgEl) {
          originalImgEl.style.display = "none";
        }

        // Set transparent background as default
        backgroundType = 'transparent';
        backgroundValue = null;

        const backgroundLayer = previewImg.querySelector(".backgroundLayer");
        if (backgroundLayer) {
          backgroundLayer.classList.add("checkerboard");
          backgroundLayer.style.backgroundColor = "";
          backgroundLayer.style.backgroundImage = "";
          backgroundLayer.style.backgroundSize = "";
          backgroundLayer.style.backgroundPosition = "";
        }

        removedImgEl.onload = null;
      };

      removedImgEl.onerror = () => {
        console.error("Main: Failed to load background-removed image");
        showError("Failed to load the background-removed image");
        removeImage();
      };
    }


    // Handle Web Worker error
    function handleWorkerError(error) {
      console.error("Main: Handling worker error:", error);
      startStarsAnimation(false);
      showError(error);
      removeImage();
    }

    // Remove image
    function removeImage() {
      console.log("Main: Removing image");
      document.getElementById('title').style.display = "block";
      dragBox.style.display = "flex";
      previewImg.style.display = "none";
      removedImgBtn.style.display = "none";
      hiddenDiv.style.display = "none";
      uploadFileInput.value = "";
      originalForegroundDataUrl = null;
      backgroundType = 'transparent';
      backgroundValue = null;

      while (previewImg.querySelector('.imageHolder')) {
        const child = previewImg.querySelector('.imageHolder');
        previewImg.removeChild(child);
      }

      if (colorsDiv.style.display === "block") {
        colorsDiv.style.display = "none";
      }
    }

    // Download button
    downloadBtn.addEventListener("click", async () => {
      if (!originalForegroundDataUrl) {
        console.log("Main: No image to download");
        showError("No image available to download");
        return;
      }
      let dataUrl;
      if (backgroundType === 'transparent') {
        dataUrl = originalForegroundDataUrl;
      } else if (backgroundType === 'color') {
        dataUrl = await compositeImages(originalForegroundDataUrl, null, backgroundValue);
      } else if (backgroundType === 'image') {
        dataUrl = await compositeImages(originalForegroundDataUrl, backgroundValue);
      }
      if (dataUrl) {
        console.log("Main: Downloading image");
        const a = document.createElement("a");
        a.href = dataUrl;
        a.download = "bg_removed.png";
        document.body.appendChild(a);
        a.click();
        a.remove();
        showSuccess("Image downloaded successfully!");
      }
    });

    // Stars animation
    function createStars(parentEl) {
      const totalStars = 15;
      const gridSize = Math.sqrt(totalStars);
      const starPositions = [];

      parentEl.style.display = "block";

      for (let i = 0; i < totalStars; i++) {
        const star = document.createElement("div");
        star.classList.add("star");

        const row = Math.floor(i / gridSize);
        const col = i % gridSize;

        const cellWidth = 100 / gridSize;
        const cellHeight = 100 / gridSize;

        const minTop = row * cellHeight;
        const maxTop = minTop + cellHeight;
        const minLeft = col * cellWidth;
        const maxLeft = minLeft + cellWidth;

        const topPos = Math.random() * (maxTop - minTop) + minTop;
        const leftPos = Math.random() * (maxLeft - minLeft) + minLeft;

        starPositions.push([topPos, leftPos]);

        star.style.top = `${topPos}%`;
        star.style.left = `${leftPos}%`;
        star.style.animationDuration = `${Math.random() * 2 + 1}s`;

        parentEl.appendChild(star);
      }
    }

    function startStarsAnimation(run) {
      const starsContainer = document.querySelector(".stars-container");
      const imageOverlay = document.querySelector(".image-overlay");

      if (!starsContainer || !imageOverlay) return;

      if (run) {
        imageOverlay.style.display = "block";
        starsContainer.style.display = "block";
        createStars(starsContainer);
        starsContainer.querySelectorAll(".star").forEach(star => {
          star.style.animationPlayState = "running";
        });
      } else {
        // Animate overlay and stars away
        imageOverlay.classList.add("overlay-slide-out");
        starsContainer.classList.add("overlay-slide-out");

        setTimeout(() => {
          imageOverlay.style.display = "none";
          starsContainer.style.display = "none";
          imageOverlay.classList.remove("overlay-slide-out");
          starsContainer.classList.remove("overlay-slide-out");

          // Remove stars
          while (starsContainer.firstChild) {
            starsContainer.removeChild(starsContainer.firstChild);
          }

          // Show remove button NOW
          removedImgBtn.style.display = "block";

        }, 1000); // match animation duration
      }
    }



    function displayColors() {
      console.log("Main: Toggling colors div");
      if (colorsDiv.style.display === "block") {
        hiddenDiv.style.display = "flex";
        colorsDiv.style.display = "none";
      } else {
        hiddenDiv.style.display = "none";
        colorsDiv.style.display = "block";
      }
    }

    const closeColorsDiv = document.getElementById("closeColorsDiv");
    closeColorsDiv.addEventListener("click", () => {
      console.log("Main: Closing colors div");
      hiddenDiv.style.display = "flex";
      colorsDiv.style.display = "none";
    });

    function removeHighlight() {
      document.querySelectorAll(".colorBtn, #colorPreview").forEach(button => {
        button.style.boxShadow = "none";
      });
    }

    // Handle color button clicks
    document.querySelectorAll(".colorBtn:not(.transparentBtn)").forEach(button => {
      button.addEventListener("click", () => {
        console.log("Main: Color button clicked:", button.style.backgroundColor);
        removeHighlight();
        button.style.boxShadow = "#71b8fb 0px 0px 15px 3px";
        backgroundType = 'color';
        backgroundValue = button.style.backgroundColor;
        const backgroundLayer = previewImg.querySelector(".backgroundLayer");
        if (backgroundLayer) {
          backgroundLayer.classList.remove("checkerboard");
          backgroundLayer.style.backgroundColor = backgroundValue;
          backgroundLayer.style.backgroundImage = "";
          backgroundLayer.style.backgroundSize = "";
          backgroundLayer.style.backgroundPosition = "";

          // Add a subtle animation
          backgroundLayer.style.transition = "all 0.3s ease";
        }
        showSuccess("Background color changed!");
      });
    });

    // Handle transparent button
    document.querySelector(".transparentBtn").addEventListener("click", () => {
      console.log("Main: Transparent background selected");
      removeHighlight();
      document.querySelector(".transparentBtn").style.boxShadow = "#71b8fb 0px 0px 15px 3px";
      backgroundType = 'transparent';
      backgroundValue = null;
      const backgroundLayer = previewImg.querySelector(".backgroundLayer");
      if (backgroundLayer) {
        backgroundLayer.classList.add("checkerboard");
        backgroundLayer.style.backgroundColor = "";
        backgroundLayer.style.backgroundImage = "";
        backgroundLayer.style.backgroundSize = "";
        backgroundLayer.style.backgroundPosition = "";

        // Add a subtle animation
        backgroundLayer.style.transition = "all 0.3s ease";
      }
      showSuccess("Background set to transparent!");
    });

    // Handle custom color input
    customColorInput.addEventListener("input", () => {
      console.log("Main: Custom color selected:", customColorInput.value);
      removeHighlight();
      colorPreview.style.boxShadow = "#71b8fb 0px 0px 15px 3px";
      colorPreview.style.backgroundColor = customColorInput.value;
      colorPreview.textContent = "";
      backgroundType = 'color';
      backgroundValue = customColorInput.value;
      const backgroundLayer = previewImg.querySelector(".backgroundLayer");
      if (backgroundLayer) {
        backgroundLayer.classList.remove("checkerboard");
        backgroundLayer.style.backgroundColor = backgroundValue;
        backgroundLayer.style.backgroundImage = "";
        backgroundLayer.style.backgroundSize = "";
        backgroundLayer.style.backgroundPosition = "";

        // Add a subtle animation
        backgroundLayer.style.transition = "all 0.3s ease";
      }
      showSuccess("Custom background color applied!");
    });

    // Handle background image upload
    document.getElementById("imageUploader").addEventListener("change", async (e) => {
      const bgFile = e.target.files[0];
      if (!bgFile) {
        console.log("Main: No background image selected");
        return;
      }
      console.log("Main: Background image selected:", bgFile.name);
      try {
        const bgDataUrl = await readFileAsDataURL(bgFile);
        backgroundType = 'image';
        backgroundValue = bgDataUrl;
        const backgroundLayer = previewImg.querySelector(".backgroundLayer");
        if (backgroundLayer) {
          backgroundLayer.classList.remove("checkerboard");
          backgroundLayer.style.backgroundColor = "";
          backgroundLayer.style.backgroundImage = `url(${bgDataUrl})`;
          backgroundLayer.style.backgroundSize = "cover";
          backgroundLayer.style.backgroundPosition = "center";

          // Add a subtle animation
          backgroundLayer.style.transition = "all 0.3s ease";
        }
        e.target.value = "";
        showSuccess("Background image applied!");
      } catch (err) {
        console.error("Main: Error applying background image:", err);
        showError("Failed to apply background image");
      }
    });

    document.getElementById("uploadSection").addEventListener("click", () => {
      console.log("Main: Opening background image uploader");
      const imageUploader = document.getElementById("imageUploader");
      imageUploader.click();
    });
  </script>



  <script>
    const lamboContainer = document.querySelector('.lambo-comparison-container');
    const lamboGridWrapper = document.querySelector('.lambo-background-wrapper');
    const lamboHandle = document.querySelector('.lambo-comparison-handle');
    const lamboHandleCircle = document.querySelector('.lambo-handle-circle');

    let isDragging = false;

    lamboHandle.addEventListener('mousedown', () => {
      isDragging = true;
      lamboHandleCircle.classList.add('active');
    });

    window.addEventListener('mouseup', () => {
      if (isDragging) {
        isDragging = false;
        lamboHandleCircle.classList.remove('active');
      }
    });

    window.addEventListener('mousemove', (e) => {
      if (!isDragging) return;
      moveHandle(e.clientX);
    });

    lamboHandle.addEventListener('touchstart', (e) => {
      e.preventDefault();
      isDragging = true;
      lamboHandleCircle.classList.add('active');
      document.body.style.overflow = 'hidden';
    });

    window.addEventListener('touchend', () => {
      if (isDragging) {
        isDragging = false;
        lamboHandleCircle.classList.remove('active');
        document.body.style.overflow = '';
      }
    });

    window.addEventListener('touchmove', (e) => {
      if (!isDragging) return;
      e.preventDefault();
      moveHandle(e.touches[0].clientX);
    }, { passive: false });

    function moveHandle(x) {
      const rect = lamboContainer.getBoundingClientRect();
      let offsetX = x - rect.left;
      if (offsetX < 0) offsetX = 0;
      if (offsetX > rect.width) offsetX = rect.width;
      const percentage = (offsetX / rect.width) * 100;

      lamboGridWrapper.style.width = `${percentage}%`;
      lamboHandle.style.left = `${percentage}%`;
    }

  </script>

  <script src="{% static 'js/page_info.js' %}"></script>


</body>
{% endblock %}